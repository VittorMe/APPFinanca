<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:APPFinanca.Libraries.Converters"
             x:Class="APPFinanca.Views.Dashboard"
             Title="Dashboard Financeiro">

    <ContentPage.Resources>
        <ResourceDictionary Source="/Resources/Styles/Colors.xaml" />
        <ResourceDictionary>
            <converters:MonthToStringConverter x:Key="MonthToStringConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="15">

            <!-- Header com Filtros -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <!-- Nome do Usuário -->
                    <Label x:Name="UserNameLabel"
                           FontSize="20" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                           HorizontalOptions="Center" />

                    <!-- Filtro por Período -->
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto">
                        <Label
                            Grid.Row="0"
                            Grid.ColumnSpan="2"
                            Text="Período de Análise"
                            FontSize="16"
                            FontAttributes="Bold"
                            HorizontalOptions="Center"
                            Margin="0,0,0,10" />
                        
                        <Picker x:Name="MonthPicker" 
                                Grid.Row="1"
                                Grid.Column="0"
                                SelectedIndexChanged="OnMonthSelected" 
                                Title="Mês"
                                Margin="0,0,5,0"
                                Style="{StaticResource FilterPickerStyle}" />
                        
                        <Picker x:Name="YearPicker" 
                                Grid.Row="1"
                                Grid.Column="1"
                                SelectedIndexChanged="OnYearSelected" 
                                Title="Ano"
                                Margin="5,0,0,0"
                                Style="{StaticResource FilterPickerStyle}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Resumo Financeiro Principal -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <Label
                        Text="Resumo Financeiro"
                        FontSize="18"
                        FontAttributes="Bold"
                        HorizontalOptions="Center" />
                    
                    <Grid ColumnDefinitions="*, *, *" RowDefinitions="Auto, Auto">
                        <!-- Saldo -->
                        <Border
                            Grid.Row="0"
                            Grid.Column="0"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#E8F5E8', Dark='#1B5E20'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Saldo" FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="BalanceLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Receitas -->
                        <Border
                            Grid.Row="0"
                            Grid.Column="1"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#E3F2FD', Dark='#1565C0'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Receitas" FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="TotalReceivedLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Despesas -->
                        <Border
                            Grid.Row="0"
                            Grid.Column="2"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#FFEBEE', Dark='#C62828'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Despesas" FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="TotalSpentLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Média Diária -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="0"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#FFF3E0', Dark='#E65100'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Média/Dia" FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="DailyAverageLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Maior Transação -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="1"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#F3E5F5', Dark='#7B1FA2'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Maior Trans." FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="LargestTransactionLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                        
                        <!-- Total Transações -->
                        <Border
                            Grid.Row="1"
                            Grid.Column="2"
                            Margin="5"
                            Padding="10"
                            BackgroundColor="{AppThemeBinding Light='#E0F2F1', Dark='#00695C'}"
                            Stroke="Transparent"
                            StrokeShape="RoundRectangle 10">
                            <VerticalStackLayout HorizontalOptions="Center">
                                <Label Text="Total Trans." FontSize="12" HorizontalOptions="Center" />
                                <Label x:Name="TotalTransactionsLabel" FontSize="16" FontAttributes="Bold" HorizontalOptions="Center" />
                            </VerticalStackLayout>
                        </Border>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Gráfico de Pizza - Distribuição por Categoria -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <Label
                        Text="Distribuição por Categoria"
                        FontSize="16"
                        FontAttributes="Bold"
                        HorizontalOptions="Center" />
                    
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto, Auto, Auto">
                        <Label x:Name="Category1Label" Grid.Row="0" Grid.Column="0" FontSize="12" />
                        <Label x:Name="Category1Value" Grid.Row="0" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label x:Name="Category2Label" Grid.Row="1" Grid.Column="0" FontSize="12" />
                        <Label x:Name="Category2Value" Grid.Row="1" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label x:Name="Category3Label" Grid.Row="2" Grid.Column="0" FontSize="12" />
                        <Label x:Name="Category3Value" Grid.Row="2" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label x:Name="Category4Label" Grid.Row="3" Grid.Column="0" FontSize="12" />
                        <Label x:Name="Category4Value" Grid.Row="3" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label x:Name="Category5Label" Grid.Row="4" Grid.Column="0" FontSize="12" />
                        <Label x:Name="Category5Value" Grid.Row="4" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Gráfico de Barras - Evolução Mensal -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <Label
                        Text="Evolução dos Últimos 6 Meses"
                        FontSize="16"
                        FontAttributes="Bold"
                        HorizontalOptions="Center" />
                    
                    <Grid ColumnDefinitions="*, *, *, *, *, *" RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto">
                        <!-- Meses -->
                        <Label x:Name="Month1Label" Grid.Row="0" Grid.Column="0" FontSize="10" HorizontalOptions="Center" />
                        <Label x:Name="Month2Label" Grid.Row="0" Grid.Column="1" FontSize="10" HorizontalOptions="Center" />
                        <Label x:Name="Month3Label" Grid.Row="0" Grid.Column="2" FontSize="10" HorizontalOptions="Center" />
                        <Label x:Name="Month4Label" Grid.Row="0" Grid.Column="3" FontSize="10" HorizontalOptions="Center" />
                        <Label x:Name="Month5Label" Grid.Row="0" Grid.Column="4" FontSize="10" HorizontalOptions="Center" />
                        <Label x:Name="Month6Label" Grid.Row="0" Grid.Column="5" FontSize="10" HorizontalOptions="Center" />
                        
                        <!-- Barras de Receitas -->
                        <BoxView x:Name="IncomeBar1" Grid.Row="1" Grid.Column="0" BackgroundColor="Green" VerticalOptions="End" />
                        <BoxView x:Name="IncomeBar2" Grid.Row="1" Grid.Column="1" BackgroundColor="Green" VerticalOptions="End" />
                        <BoxView x:Name="IncomeBar3" Grid.Row="1" Grid.Column="2" BackgroundColor="Green" VerticalOptions="End" />
                        <BoxView x:Name="IncomeBar4" Grid.Row="1" Grid.Column="3" BackgroundColor="Green" VerticalOptions="End" />
                        <BoxView x:Name="IncomeBar5" Grid.Row="1" Grid.Column="4" BackgroundColor="Green" VerticalOptions="End" />
                        <BoxView x:Name="IncomeBar6" Grid.Row="1" Grid.Column="5" BackgroundColor="Green" VerticalOptions="End" />
                        
                        <!-- Barras de Despesas -->
                        <BoxView x:Name="ExpenseBar1" Grid.Row="2" Grid.Column="0" BackgroundColor="Red" VerticalOptions="End" />
                        <BoxView x:Name="ExpenseBar2" Grid.Row="2" Grid.Column="1" BackgroundColor="Red" VerticalOptions="End" />
                        <BoxView x:Name="ExpenseBar3" Grid.Row="2" Grid.Column="2" BackgroundColor="Red" VerticalOptions="End" />
                        <BoxView x:Name="ExpenseBar4" Grid.Row="2" Grid.Column="3" BackgroundColor="Red" VerticalOptions="End" />
                        <BoxView x:Name="ExpenseBar5" Grid.Row="2" Grid.Column="4" BackgroundColor="Red" VerticalOptions="End" />
                        <BoxView x:Name="ExpenseBar6" Grid.Row="2" Grid.Column="5" BackgroundColor="Red" VerticalOptions="End" />
                        
                        <!-- Valores -->
                        <Label x:Name="Value1Label" Grid.Row="3" Grid.Column="0" FontSize="8" HorizontalOptions="Center" />
                        <Label x:Name="Value2Label" Grid.Row="3" Grid.Column="1" FontSize="8" HorizontalOptions="Center" />
                        <Label x:Name="Value3Label" Grid.Row="3" Grid.Column="2" FontSize="8" HorizontalOptions="Center" />
                        <Label x:Name="Value4Label" Grid.Row="3" Grid.Column="3" FontSize="8" HorizontalOptions="Center" />
                        <Label x:Name="Value5Label" Grid.Row="3" Grid.Column="4" FontSize="8" HorizontalOptions="Center" />
                        <Label x:Name="Value6Label" Grid.Row="3" Grid.Column="5" FontSize="8" HorizontalOptions="Center" />
                        
                        <!-- Legenda -->
                        <Label Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" Text="Receitas" FontSize="10" HorizontalOptions="Center" />
                        <Label Grid.Row="4" Grid.Column="3" Grid.ColumnSpan="3" Text="Despesas" FontSize="10" HorizontalOptions="Center" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Análise Detalhada -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <Label
                        Text="Análise Detalhada"
                        FontSize="16"
                        FontAttributes="Bold"
                        HorizontalOptions="Center" />
                    
                    <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto, Auto">
                        <Label Text="Dia com mais gastos:" Grid.Row="0" Grid.Column="0" FontSize="12" />
                        <Label x:Name="HighestSpendingDayLabel" Grid.Row="0" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label Text="Categoria mais cara:" Grid.Row="1" Grid.Column="0" FontSize="12" />
                        <Label x:Name="MostExpensiveCategoryLabel" Grid.Row="1" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label Text="Forma de pagamento mais usada:" Grid.Row="2" Grid.Column="0" FontSize="12" />
                        <Label x:Name="MostUsedPaymentLabel" Grid.Row="2" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                        
                        <Label Text="Transações recorrentes:" Grid.Row="3" Grid.Column="0" FontSize="12" />
                        <Label x:Name="RecurringTransactionsLabel" Grid.Row="3" Grid.Column="1" FontSize="12" HorizontalOptions="End" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Top 5 Transações -->
            <Border
                Padding="15"
                BackgroundColor="{AppThemeBinding Light='#F8F9FA', Dark='#2A2A2A'}"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 15">
                
                <VerticalStackLayout Spacing="15">
                    <Label
                        Text="Top 5 Maiores Transações"
                        FontSize="16"
                        FontAttributes="Bold"
                        HorizontalOptions="Center" />
                    
                    <CollectionView x:Name="TopTransactionsCollectionView" HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,2"
                                    Padding="10"
                                    BackgroundColor="{AppThemeBinding Light='#FFFFFF', Dark='#3A3A3A'}"
                                    Stroke="Transparent"
                                    StrokeShape="RoundRectangle 8">
                                    
                                    <Grid ColumnDefinitions="*, Auto">
                                        <VerticalStackLayout Grid.Column="0">
                                            <Label Text="{Binding Name}" FontSize="14" FontAttributes="Bold" />
                                            <Label Text="{Binding Date, StringFormat='{0:dd/MM/yyyy}'}" FontSize="12" TextColor="Gray" />
                                            <Label Text="{Binding Group}" FontSize="12" TextColor="Gray" />
                                        </VerticalStackLayout>
                                        
                                        <Label Grid.Column="1"
                                               Text="{Binding Value, StringFormat='R$ {0:N2}'}"
                                               FontSize="16"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>